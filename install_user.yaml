---
- hosts: centos
  remote_user: sgrosu
  tasks:
  - name: Ensure ansible username exists
    user: 
      name: ansible
      state: present
      comment: Ansible
      groups: wheel
      append: yes
    become: yes
  - name: Copy user's SSH key to the machine
    authorized_key: 
      user: ansible
      state: present
      key: "{{ lookup('file', '/home/sgrosu/ansible_key/id_rsa.pub') }}"
    become: yes
  - name: copy key to remote machine
    copy:
      src: /home/sgrosu/ansible_key/id_rsa.pub
      dest: /home/ansible/authorized_keys
      mode: 0700
    become: yes
  - name: Ensure the user is sudoer with no password
    lineinfile:
      dest: /etc/sudoers
      state: present
      regexp: '^ansible ALL\='
      line: 'ansible ALL=(ALL) NOPASSWD:ALL'
      validate: 'visudo -cf %s'
    become: yes